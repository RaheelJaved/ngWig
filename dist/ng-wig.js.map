{"version":3,"sources":["ng-wig.js"],"names":["VERSION","angular","module","ngWig","version","component","bindings","content","options","onPaste","buttons","beforeExecCommand","afterExecCommand","placeholder","require","ngModelController","templateUrl","controller","$scope","$element","$q","$attrs","$window","$document","ngWigToolbar","$container","element","querySelector","required","isSourceModeAllowed","editMode","$observe","isDisabled","disabled","attr","isEditorActive","activeElement","toggleEditMode","getSelection","removeAllRanges","execCommand","command","queryCommandSupported","prompt","selection","toString","length","focus","$onInit","toolbarButtons","getToolbarButtons","string2array","Boolean","$render","$viewValue","html","empty","bind","$setViewValue","$applyAsync","on","event","pasteContent","window","clipboardData","getData","originalEvent","preventDefault","when","$event","then","pasteText","pasteHtmlAtCaret","keysString","split","map","Function","prototype","call","String","trim","sel","range","getRangeAt","rangeCount","deleteContents","el","document","createElement","innerHTML","frag","createDocumentFragment","node","lastNode","firstChild","appendChild","insertNode","cloneRange","setStartAfter","collapse","addRange","type","createRange","pasteHTML","provider","buttonLibrary","list1","title","styleClass","list2","bold","italic","link","defaultButtonsList","isButtonActive","queryCommandState","setButtons","isArray","addStandardButton","name","push","addCustomButton","pluginName","isComplex","$get","list","forEach","buttonKey","Object","keys","button","copy","isActive","plugin","$compile","$ctrl","replaceWith","run","$templateCache","put"],"mappings":"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","file":"ng-wig.js","sourcesContent":["/**\r\n * version: 3.0.16\r\n */\r\nvar VERSION = '3.0.16';\r\nangular.module('ngWig', ['ngwig-app-templates']);\r\nangular.ngWig = {\r\n  version: VERSION\r\n};\r\n\r\nangular.module('ngWig')\r\n  .component('ngWig', {\r\n    bindings: {\r\n      content: '=ngModel',\r\n      options: '<?',\r\n      onPaste: '&',\r\n      buttons: '@',\r\n      beforeExecCommand: '&',\r\n      afterExecCommand: '&' ,\r\n      placeholder: '@?'\r\n    },\r\n    require: {\r\n      ngModelController: 'ngModel'\r\n    },\r\n    templateUrl: 'ng-wig/views/ng-wig.html',\r\n    controller: [\"$scope\", \"$element\", \"$q\", \"$attrs\", \"$window\", \"$document\", \"ngWigToolbar\", function($scope, $element, $q, $attrs, $window, $document, ngWigToolbar) {\r\n\r\n      var $container = angular.element($element[0].querySelector('#ng-wig-editable'));\r\n\r\n      //TODO: clean-up this attrs solution\r\n      this.required = 'required' in $attrs;\r\n      this.isSourceModeAllowed = 'sourceModeAllowed' in $attrs;\r\n      this.editMode = false;\r\n      \r\n      $attrs.$observe('disabled', (isDisabled) => {\r\n        this.disabled = isDisabled;\r\n        $container.attr('contenteditable', !isDisabled);\r\n      });\r\n      this.isEditorActive = () => $container[0] === $document[0].activeElement;\r\n      this.toggleEditMode = () => {\r\n        this.editMode = !this.editMode;\r\n        if ($window.getSelection().removeAllRanges) {\r\n          $window.getSelection().removeAllRanges();\r\n        }\r\n      };\r\n\r\n      this.execCommand = (command, options) => {\r\n        if (this.editMode) return false;\r\n\r\n        if ($document[0].queryCommandSupported && !$document[0].queryCommandSupported(command)) {\r\n          throw 'The command \"' + command + '\" is not supported';\r\n        }\r\n\r\n        if (command === 'createlink' || command === 'insertImage') {\r\n          options = $window.prompt('Please enter the URL', 'http://');\r\n          if (!options) {\r\n            return;\r\n          }\r\n        }\r\n\r\n        this.beforeExecCommand({command: command, options: options});\r\n\r\n        // use insertHtml for `createlink` command to account for IE/Edge purposes, in case there is no selection\r\n        let selection = $document[0].getSelection().toString();\r\n        if(command === 'createlink' && selection === ''){\r\n          $document[0].execCommand('insertHtml', false, '<a href=\"' + options + '\">' + options + '</a>');\r\n        }\r\n        else{\r\n          $document[0].execCommand(command, false, options);\r\n        }\r\n\r\n        this.afterExecCommand({command: command, options: options});\r\n\r\n        // added temporarily to pass the tests. For some reason $container[0] is undefined during testing.\r\n        if($container.length){\r\n          $container[0].focus();\r\n        }\r\n      };\r\n\r\n      this.$onInit = () => {\r\n        this.toolbarButtons = ngWigToolbar.getToolbarButtons(this.buttons && string2array(this.buttons));\r\n        \r\n        let placeholder = Boolean(this.placeholder);\r\n\r\n        this.ngModelController.$render = () => this.ngModelController.$viewValue\r\n          ? $container.html(this.ngModelController.$viewValue)\r\n          : placeholder ? $container.empty()\r\n          : $container.html('<p></p>');\r\n\r\n        $container.bind('blur keyup change focus click', () => {\r\n          //view --> model\r\n          if (placeholder && (!$container.html().length || $container.html() === \"<br>\")) $container.empty();\r\n          this.ngModelController.$setViewValue($container.html());\r\n          $scope.$applyAsync();\r\n        });\r\n      };\r\n\r\n      $container.on('paste', (event) => {\r\n        if(!$attrs.onPaste){\r\n          return;\r\n        }\r\n\r\n        let pasteContent;\r\n        if (window.clipboardData && window.clipboardData.getData) { // IE\r\n          pasteContent = window.clipboardData.getData('Text');\r\n        }\r\n        else{\r\n          pasteContent = (event.originalEvent || event).clipboardData.getData('text/plain');\r\n        }\r\n        event.preventDefault();\r\n        $q.when(this.onPaste({$event: event, pasteContent: pasteContent})).then((pasteText) => {\r\n          pasteHtmlAtCaret(pasteText);\r\n        });\r\n      });\r\n    }]\r\n  });\r\n\r\n\r\n//TODO: check the function\r\nfunction string2array(keysString) {\r\n  return keysString.split(',').map(Function.prototype.call, String.prototype.trim);\r\n}\r\n\r\n\r\n//TODO: put contenteditable helper into service\r\nfunction pasteHtmlAtCaret(html) {\r\n  var sel, range;\r\n  if (window.getSelection) {\r\n    sel = window.getSelection();\r\n    if (sel.getRangeAt && sel.rangeCount) {\r\n      range = sel.getRangeAt(0);\r\n      range.deleteContents();\r\n\r\n      // Range.createContextualFragment() would be useful here but is\r\n      // non-standard and not supported in all browsers (IE9, for one)\r\n      var el = document.createElement(\"div\");\r\n      el.innerHTML = html;\r\n      var frag = document.createDocumentFragment(), node, lastNode;\r\n      while ( (node = el.firstChild) ) {\r\n        lastNode = frag.appendChild(node);\r\n      }\r\n      range.insertNode(frag);\r\n\r\n      // Preserve the selection\r\n      if (lastNode) {\r\n        range = range.cloneRange();\r\n        range.setStartAfter(lastNode);\r\n        range.collapse(true);\r\n        sel.removeAllRanges();\r\n        sel.addRange(range);\r\n      }\r\n    }\r\n  } else if (document.selection && document.selection.type != \"Control\") {\r\n    // IE < 9\r\n    document.selection.createRange().pasteHTML(html);\r\n  }\r\n}\r\n\r\nangular.module('ngWig').provider('ngWigToolbar', function () {\r\n\r\n  var buttonLibrary = {\r\n    list1: {title: 'Unordered List', command: 'insertunorderedlist', styleClass: 'list-ul'},\r\n    list2: {title: 'Ordered List', command: 'insertorderedlist', styleClass: 'list-ol'},\r\n    bold: {title: 'Bold', command: 'bold', styleClass: 'bold'},\r\n    italic: {title: 'Italic', command: 'italic', styleClass: 'italic'},\r\n    link: {title: 'Link', command: 'createlink', styleClass: 'link'}\r\n  };\r\n\r\n  var defaultButtonsList = ['list1', 'list2', 'bold', 'italic', 'link'];\r\n\r\n  var isButtonActive = function () {\r\n    return !!this.command && document.queryCommandState(this.command);\r\n  };\r\n\r\n  this.setButtons = function(buttons) {\r\n    if(!angular.isArray(buttons)) {\r\n      throw 'Argument \"buttons\" should be an array';\r\n    }\r\n\r\n    defaultButtonsList = buttons;\r\n  };\r\n\r\n  this.addStandardButton = function (name, title, command, styleClass) {\r\n    if(!name || !title || !command) {\r\n      throw 'Arguments \"name\", \"title\" and \"command\" are required';\r\n    }\r\n\r\n    styleClass = styleClass || '';\r\n    buttonLibrary[name] = {title: title, command: command, styleClass: styleClass}\r\n    defaultButtonsList.push(name);\r\n  };\r\n\r\n  this.addCustomButton = function (name, pluginName) {\r\n    if(!name || !pluginName) {\r\n      throw 'Arguments \"name\" and \"pluginName\" are required';\r\n    }\r\n\r\n    buttonLibrary[name] = {pluginName: pluginName, isComplex: true};\r\n    defaultButtonsList.push(name);\r\n  };\r\n\r\n  this.$get = function () {\r\n    return {\r\n      getToolbarButtons: function(list) {\r\n        var toolbarButtons = [];\r\n        (list || defaultButtonsList).forEach(function(buttonKey) {\r\n          if(!buttonLibrary[buttonKey]) {\r\n            throw 'There is no \"' + buttonKey + '\" in your library. Possible variants: ' + Object.keys(buttonLibrary);\r\n          }\r\n\r\n          var button = angular.copy(buttonLibrary[buttonKey]);\r\n          button.isActive = isButtonActive;\r\n          toolbarButtons.push(button);\r\n        });\r\n        return toolbarButtons;\r\n      }\r\n    };\r\n  };\r\n\r\n});\r\nangular.module('ngWig')\r\n  .component('ngWigPlugin', {\r\n    bindings: {\r\n      plugin: '<',\r\n      execCommand: '=',\r\n      editMode: '=',\r\n      disabled: '=',\r\n      options: '<',\r\n      content: '='\r\n    },\r\n    controller: [\"$scope\", \"$element\", \"$compile\", function($scope, $element, $compile) {\r\n      var $ctrl = this;\r\n      this.$onInit = function() {\r\n        $element.replaceWith($compile('<' + $ctrl.plugin.pluginName + ' ' +\r\n        'plugin=' + '\"$ctrl.plugin\"' +\r\n        'exec-command=' + '\"$ctrl.execCommand\"' +\r\n        'edit-mode=' + '\"$ctrl.editMode\"' +\r\n        'disabled=' + '\"$ctrl.disabled\"' +\r\n        'options=' + '\"$ctrl.options\"' +\r\n        'content=' + '\"$ctrl.content\"' +\r\n        '/>')($scope));\r\n      }\r\n      \r\n    }]\r\n  });\r\nangular.module('ngwig-app-templates', ['ng-wig/views/ng-wig.html']);\r\n\r\nangular.module(\"ng-wig/views/ng-wig.html\", []).run([\"$templateCache\", function($templateCache) {\r\n  $templateCache.put(\"ng-wig/views/ng-wig.html\",\r\n    \"<div class=\\\"ng-wig\\\">\\n\" +\r\n    \"  <ul class=\\\"nw-toolbar\\\">\\n\" +\r\n    \"    <li class=\\\"nw-toolbar__item\\\" ng-repeat=\\\"button in $ctrl.toolbarButtons\\\">\\n\" +\r\n    \"        <div ng-if=\\\"!button.isComplex\\\">\\n\" +\r\n    \"          <button type=\\\"button\\\"\\n\" +\r\n    \"                  class=\\\"nw-button {{button.styleClass}}\\\"\\n\" +\r\n    \"                  title=\\\"{{button.title}}\\\"\\n\" +\r\n    \"                  ng-click=\\\"$ctrl.execCommand(button.command)\\\"\\n\" +\r\n    \"                  ng-class=\\\"{ 'nw-button--active': !$ctrl.disabled && $ctrl.isEditorActive() && button.isActive() }\\\"\\n\" +\r\n    \"                  ng-disabled=\\\"$ctrl.editMode || $ctrl.disabled\\\">\\n\" +\r\n    \"            {{ button.title }}\\n\" +\r\n    \"          </button>\\n\" +\r\n    \"        </div>\\n\" +\r\n    \"        <div ng-if=\\\"button.isComplex\\\">\\n\" +\r\n    \"          <ng-wig-plugin\\n\" +\r\n    \"              exec-command=\\\"$ctrl.execCommand\\\"\\n\" +\r\n    \"              plugin=\\\"button\\\"\\n\" +\r\n    \"              edit-mode=\\\"$ctrl.editMode\\\"\\n\" +\r\n    \"              disabled=\\\"$ctrl.disabled\\\"\\n\" +\r\n    \"              options=\\\"$ctrl.options\\\"\\n\" +\r\n    \"              content=\\\"$ctrl.content\\\"></ng-wig-plugin>\\n\" +\r\n    \"        </div>\\n\" +\r\n    \"    </li><!--\\n\" +\r\n    \"    --><li class=\\\"nw-toolbar__item\\\">\\n\" +\r\n    \"      <button type=\\\"button\\\"\\n\" +\r\n    \"              class=\\\"nw-button nw-button--source\\\"\\n\" +\r\n    \"              title=\\\"Edit HTML\\\"\\n\" +\r\n    \"              ng-class=\\\"{ 'nw-button--active': $ctrl.editMode }\\\"\\n\" +\r\n    \"              ng-if=\\\"$ctrl.isSourceModeAllowed\\\"\\n\" +\r\n    \"              ng-click=\\\"$ctrl.toggleEditMode()\\\"\\n\" +\r\n    \"              ng-disabled=\\\"$ctrl.disabled\\\">\\n\" +\r\n    \"        Edit HTML\\n\" +\r\n    \"      </button>\\n\" +\r\n    \"    </li>\\n\" +\r\n    \"  </ul>\\n\" +\r\n    \"\\n\" +\r\n    \"  <div class=\\\"nw-editor-container\\\">\\n\" +\r\n    \"    <div class=\\\"nw-editor__src-container\\\" ng-show=\\\"$ctrl.editMode\\\">\\n\" +\r\n    \"      <textarea ng-model=\\\"$ctrl.content\\\"\\n\" +\r\n    \"                ng-disabled=\\\"$ctrl.disabled\\\"\\n\" +\r\n    \"                class=\\\"nw-editor__src\\\"></textarea>\\n\" +\r\n    \"    </div>\\n\" +\r\n    \"    <div class=\\\"nw-editor\\\" ng-class=\\\"{ 'nw-disabled': $ctrl.disabled }\\\">\\n\" +\r\n    \"      <div id=\\\"ng-wig-editable\\\"\\n\" +\r\n    \"           class=\\\"nw-editor__res\\\"\\n\" +\r\n    \"           ng-class=\\\"{'nw-invisible': $ctrl.editMode}\\\"\\n\" +\r\n    \"           ng-disabled=\\\"$ctrl.disabled\\\"\\n\" +\r\n    \"           contenteditable\\n\" +\r\n    \"           placeholder=\\\"{{$ctrl.placeholder}}\\\">\\n\" +\r\n    \"      </div>\\n\" +\r\n    \"    </div>\\n\" +\r\n    \"  </div>\\n\" +\r\n    \"</div>\\n\" +\r\n    \"\");\r\n}]);\r\n"]}